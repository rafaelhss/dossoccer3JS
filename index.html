<!DOCTYPE html>
<html>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
<script src="pass.js"></script>

<style>

    .teamx{
        color: blue;
    }
    .teamo{
        color: red;
    }
</style>   
<style>
.tooltip {
  position: relative;
  display: inline-block;+
}

.tooltip .tooltiptext {
  visibility: hidden;
  width: 800px;
  background-color: black;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 5px 0;

  /* Position the tooltip */
  position: absolute;
  z-index: 1;
}

.tooltip:hover .tooltiptext {
  visibility: visible;
}
</style>
<body>

<div ng-app="myApp" ng-controller="myCtrl">

First Name: <input type="text" ng-model="firstName"><br>
Last Name: <input type="text" ng-model="lastName"><br>
<br>
Full Name: {{firstName + " " + lastName}}
<hr>
<button ng-click="pass('x',1,0)">Pass x ></button>    
<button ng-click="pass('x',1,1)">Pass x >v</button>    
<button ng-click="pass('x',0,1)">Pass x v</button>    
<button ng-click="pass('x',-1,1)">Pass x &lt;v </button>    
<button ng-click="pass('x',-1,0)">Pass x &lt;</button>    
<button ng-click="pass('x',-1,-1)">Pass x &lt;^</button>    
<button ng-click="pass('x',0,-1)">Pass x ^</button>  
<button ng-click="pass('x',1,-1)">Pass x ^></button>  
<hr>
<button ng-click="shot('x')">Shot X</button>    

<hr>
<hr>
<button ng-click="pass('o',1,0)">Pass o ></button>    
<button ng-click="pass('o',1,1)">Pass o >v</button>    
<button ng-click="pass('o',0,1)">Pass o v</button>    
<button ng-click="pass('o',-1,1)">Pass o &lt;v </button>    
<button ng-click="pass('o',-1,0)">Pass o &lt;</button>    
<button ng-click="pass('o',-1,-1)">Pass o &lt;^</button>    
<button ng-click="pass('o',0,-1)">Pass o ^</button>   
<button ng-click="pass('o',1,-1)">Pass o ^></button>   
<div>
    log:
    <ul>
        <li>{{msg}}</li>
    </ul>    
</div>    
<hr>    
    displayableField.ballholder.id:{{displayableField.ballholder.id}}
<table style="width: 200px; height: 300px" border = "1">
	<tbody>
        <tr>
            <td colspan=2 style="text-align:center">
                <span class="teamx">
                    {{displayableField.keeper['x'].number}}
                    <span ng-show="displayableField.ballholder.id == displayableField.keeper['x'].id">.</span>
                </span>

            </td>
         </tr>
		<tr>
			<td>
                <span ng-repeat="player in displayableField.field[0]" >
                    <div class="tooltip">
                        <span ng-class="{'teamx': player.team == 'x', 'teamo': player.team == 'o'}">
                            {{player.number}} <span ng-show="displayableField.ballholder.id == player.id">.</span>
                        </span>
                        <span class="tooltiptext">{{player}}</span>
                    </div> 
                </span> 
            </td>
			<td>
                <span ng-repeat="player in displayableField.field[1]" >
                    <div class="tooltip">
                        <span ng-class="{'teamx': player.team == 'x', 'teamo': player.team == 'o'}">
                            {{player.number}} <span ng-show="displayableField.ballholder.id == player.id">.</span>
                        </span>
                        <span class="tooltiptext">{{player}}</span>
                    </div> 
                </span> 
            </td>
        </tr>
		<tr>
			<td>
                <span ng-repeat="player in displayableField.field[2]" >
                    <div class="tooltip">
                        <span ng-class="{'teamx': player.team == 'x', 'teamo': player.team == 'o'}">
                            {{player.number}} <span ng-show="displayableField.ballholder.id == player.id">.</span>
                        </span>
                        <span class="tooltiptext">{{player}}</span>
                    </div> 
                </span> 
            </td>
			<td>
                <span ng-repeat="player in displayableField.field[3]" >
                    <div class="tooltip">
                        <span ng-class="{'teamx': player.team == 'x', 'teamo': player.team == 'o'}">
                            {{player.number}} <span ng-show="displayableField.ballholder.id == player.id">.</span>
                        </span>
                        <span class="tooltiptext">{{player}}</span>
                    </div> 
                </span> 
            </td>            
		</tr>
		<tr>			<td>
                <span ng-repeat="player in displayableField.field[4]" >
                    <div class="tooltip">
                        <span ng-class="{'teamx': player.team == 'x', 'teamo': player.team == 'o'}">
                            {{player.number}} <span ng-show="displayableField.ballholder.id == player.id">.</span>
                        </span>
                        <span class="tooltiptext">{{player}}</span>
                    </div> 
                </span> 
            </td>			<td>
                <span ng-repeat="player in displayableField.field[5]" >
                    <div class="tooltip">
                        <span ng-class="{'teamx': player.team == 'x', 'teamo': player.team == 'o'}">
                            {{player.number}} <span ng-show="displayableField.ballholder.id == player.id">.</span>
                        </span>
                        <span class="tooltiptext">{{player}}</span>
                    </div> 
                </span> 
            </td>
		</tr>
        <tr>
            <td colspan=2 style="text-align:center">
                <span class="teamo">
                    {{displayableField.keeper['o'].number}}
                    <span ng-show="displayableField.ballholder.id == displayableField.keeper['o'].id">.</span>
                </span>
            </td>
         </tr>
	</tbody>
</table>
running : {{displayableField}}
<hr>
found: {{displayableField.keeper['x']}}

</div>

<script>
var app = angular.module('myApp', []);
var game = {};
var TEAMX = "x";
var TEAMO = "o";
var getOpposingTeam = function(team){
    if(team == TEAMO) return TEAMX;
    else return TEAMO;
}
    
    
function rand(n){
    return Math.floor(Math.random() * n);
}   
    function shotGetSectorsAhead(){
        if(game.ballholder.sector == 0){
            if(game.ballholder.team == TEAMX) { return [0,2,4] }
            else {return [0]}
        }
        if(game.ballholder.sector == 1){
            if(game.ballholder.team == TEAMX) { return [1,3,5] }
            else {return [1]}
        }
        if(game.ballholder.sector == 2){
            if(game.ballholder.team == TEAMX) { return [2,4] }
            else {return [0,2]}
        }
        if(game.ballholder.sector == 3){
            if(game.ballholder.team == TEAMX) { return [3,5] }
            else {return [1,3]}
        }
        if(game.ballholder.sector == 4){
            if(game.ballholder.team == TEAMX) { return [4] }
            else {return [0,2,4]}
        }
        if(game.ballholder.sector == 5){
            if(game.ballholder.team == TEAMX) { return [5] }
            else {return [1,3,5]}
        }
    }
    
    function shotProcess(team){
        var actionResult = {};
        actionResult.messages = [];
        actionResult.messages.push("Tentativa de shot");
        actionResult.scoreo = game.scoreo;
        actionResult.scorex = game.scorex;
        
        if(game.ballholder.team == team) {
            var sectors = shotGetSectorsAhead();
            console.log("sectors");
            console.log(sectors);
                        
        } else {
            actionResult.messages.push("Voce nao esta com a bola e nao pode bater no gol");
        }
        return actionResult;
    }
 

function createTestGame(){
    

    
    var field = [];
    
    for (let i = 2; i <= 11; ++i){
        var player2 = { 
                            number: i,
                            defense:rand(10), 
                            pass:rand(10), 
                            attack:rand(10), 
                            team: TEAMX, 
                            sector:rand(6),
                            id: rand(100)*rand(100)
                        };
        field.push(player2);
    }
    for (let i = 2; i <= 11; ++i){
        var player2 = { 
                            number: i,
                            defense:rand(10), 
                            pass:rand(10), 
                            attack:rand(10), 
                            team: TEAMO, 
                            sector:rand(6),
                            id: rand(100)*rand(100)                            
                        };
        field.push(player2);
    }
    
    
    game.ballholder = field[rand(20)];
    game.field = field;
    game.scorex = 0;
    game.scoreo = 0;
    game.keeper = [];
    game.keeper[TEAMX] = { 
                            number: 1,
                            pass: 10,
                            defense:rand(10), 
                            team: TEAMX, 
                            sector:-1,
                            id: rand(100)*rand(100)                            
                        };
    game.keeper[TEAMO] = { 
                            number: 1,
                            pass: 10,
                            defense:rand(10), 
                            team: TEAMO, 
                            sector:-2,
                            id: rand(100)*rand(100)                            
                        };
    
    return game;
}

function displayField(game){
    
    var field = [[],[],[],[],[],[]];
    game.field.forEach(function(item){
        field[item.sector].push(item); 
    });
    var displayable = {};
    displayable.field = field;
    displayable.ballholder = game.ballholder;
    displayable.keeper = [];
    displayable.keeper['x'] = game.keeper[TEAMX]
    displayable.keeper['o'] = game.keeper[TEAMO]
		
    return displayable;
}    
    
function processTick(game, commandP1, commandP2, scope){
    /*console.log("Processing:")
    console.log(game);
    console.log(commandP1);
    console.log(commandP2);
    */
    return displayField(game);
    
}
    
    
    app.controller('myCtrl', function($scope/*, $interval*/) {
   
    game = createTestGame();
    
    
    $scope.pass = function(team, axisx, axisy){
        var actionResult = passProcess(team, axisx, axisy);
        if(actionResult.newBallholder){
            game.ballholder = actionResult.newBallholder;
            actionResult.messages.forEach(function(msg){console.log("ACTION MSG: " + msg)})
            $scope.displayableField = processTick(game, commandP1, commandP2);
        }
    }
    
    $scope.shot = function(team) {
        var actionResult = shotProcess(team);
        game.scoreo = actionResult.scoreo;
        game.scorex = actionResult.scorex;
      //  game.ballholder = actionResult.newBallholder;
            
        actionResult.messages.forEach(function(msg){console.log("ACTION MSG: " + msg)})
        $scope.displayableField = processTick(game, commandP1, commandP2);
    }
    
    var commandP1 = "pass to joao";
    var commandP2 = "mark joao";
    
    
  //  $interval(function(){$scope.displayableField = processTick(game, commandP1, commandP2), 10000, 1})
    $scope.displayableField = processTick(game, commandP1, commandP2);
    //setInterval(function(){$scope.displayableField = "samba"}, 900);
    
//    /processTick(createTestGame(), commandP1, commandP2)
    
});
    
    
</script>

</body>
</html>