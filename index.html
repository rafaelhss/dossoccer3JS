<!DOCTYPE html>
<html>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
<script src="gameplayutils.js"></script>
<script src="pass.js"></script>
<script src="shot.js"></script>
<script src="dibre.js"></script>
<script src="touch.js"></script>
<script src="cmd.js"></script>

    
<style>

    .teamx{
        color: blue;
    }
    .teamo{
        color: red;
    }
    .playeroff {
        text-decoration: line-through;
    }
</style>   

<style>

.button {
  border: none;
  color: white;
  padding: 10px 15px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 12px;
  margin: 2px 1px;
}
.buttonx {
  background-color: #0000FF;
}
    
.buttono {
  background-color: #ff0000;
}
</style>
    
<style>
.tooltip {
  position: relative;
  display: inline-block;
}

.tooltip .tooltiptext {
  visibility: hidden;
  width: 500px;
  background-color: black;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 5px 0;

  /* Position the tooltip */
  position: absolute;
  z-index: 1;
}

.tooltip:hover .tooltiptext {
  visibility: visible;
}
</style>
    
<!--touc -->
<style>
    body {
        padding: 50px;
        font-family: sans-serif;
    }

    #box {
        width:  100px;
        height: 100px;
        background-color: red;
    }
</style>
<body>

<div ng-app="myApp" ng-controller="myCtrl">

First Name: <input type="text" ng-model="firstName"><br>
Last Name: <input type="text" ng-model="lastName"><br>
<br>
Full Name: {{firstName + " " + lastName}}
<hr>

<canvas id="canvas" width="400" height="400" style="border:solid black 1px;">
  You really badly need to use a different browser.
</canvas>
<br>
<button onclick="window.startup();">Initialize</button>
<button onclick="window.initcmd();">Initialize</button>
<br>
Log: <pre id="log" style="border: 1px solid #ccc;"></pre>
    

<hr>
<hr>

<div>
    log:
    <ul>
        <li>{{msg}}</li>
    </ul>    
</div> 
<div>
    <h1>
        <table border="0">
            <tr>
            <td class="teamx">Team X</td>
            <td>{{displayableField.scorex}}</td>
            <td>X</td>
            <td>{{displayableField.scoreo}}</td>
            <td class="teamo">Team O</td>
            </tr>
        </table>
    </h1>
</div>
<hr>    
    displayableField.ballholder.id:{{displayableField.ballholder.id}}
<table style="width: 800px; height: 300px" border = "1">
	<tbody>
        <tr>
            <td>
                <span >
                    <button class="buttonx button" ng-click="pass('x',-1,-1)">&nwarr; ({{displayableField.chancesx[0]}})</button>    
                    <button class="buttonx button" ng-click="pass('x',0,-1)">&uarr;({{displayableField.chancesx[1]}}%)</button>  
                    <button class="buttonx button" ng-click="pass('x',1,-1)">&nearr;({{displayableField.chancesx[2]}}%)</button>  
                    <br>
                    <button class="buttonx button" ng-click="pass('x',-1,0)">&larr;({{displayableField.chancesx[3]}}%)</button>
                    <button class="buttonx button" ng-click="dibre('x')">Z ({{displayableField.chancesx[4]}}%)</button>
                    <button class="buttonx button" ng-click="pass('x',1,0)">&rarr; ({{displayableField.chancesx[5]}}%)</button>    
                    <br>
                    <button class="buttonx button" ng-click="pass('x',-1,1)">&swarr; ({{displayableField.chancesx[6]}}%)</button>    
                    <button class="buttonx button" ng-click="pass('x',0,1)">&darr; ({{displayableField.chancesx[7]}}%)</button>    
                    <button class="buttonx button" ng-click="pass('x',1,1)">&searr; ({{displayableField.chancesx[8]}}%)</button>    
                    <br>
                    <button class="buttonx button" ng-click="shot('x')">Shot X ({{displayableField.chancesx[9]}}%)</button>      
                </span>
            </td>
            <td>
            
            <table style="width: 200px; height: 300px" border = "1">    
                <tbody>
                    <tr>
                        <td colspan=2 style="text-align:center">
                        <div class="tooltip">
                            <span class="teamx">
                                {{displayableField.keeper['x'].number}}
                                <span ng-show="displayableField.ballholder.id == displayableField.keeper['x'].id">.</span>
                                <span class="tooltiptext">{{displayableField.keeper['x']}}</span>
                            </span>
                        </div>
                        </td>
                     </tr>
                    <tr>
                        <td>
                            <span ng-repeat="player in displayableField.field[0]" >
                                <div class="tooltip">
                                    <span ng-class="{'teamx': player.team == 'x', 
                                                    'teamo': player.team == 'o',
                                                    'playeroff': player.off == true}">
                                        {{player.number}} <span ng-show="displayableField.ballholder.id == player.id">.</span>
                                    </span>
                                    <span class="tooltiptext">{{player}}</span>
                                </div> 
                            </span> 
                        </td>
                        <td>
                            <span ng-repeat="player in displayableField.field[1]" >
                                <div class="tooltip">
                                    <span ng-class="{'teamx': player.team == 'x', 'teamo': player.team == 'o',
                                                    'playeroff':  player.off == true}">
                                        {{player.number}} <span ng-show="displayableField.ballholder.id == player.id">.</span>
                                    </span>
                                    <span class="tooltiptext">{{player}}</span>
                                </div> 
                            </span> 
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span ng-repeat="player in displayableField.field[2]" >
                                <div class="tooltip">
                                    <span ng-class="{'teamx': player.team == 'x', 'teamo': player.team == 'o',
                                                    'playeroff':  player.off == true}">
                                        {{player.number}} <span ng-show="displayableField.ballholder.id == player.id">.</span>
                                    </span>
                                    <span class="tooltiptext">{{player}}</span>
                                </div> 
                            </span> 
                        </td>
                        <td>
                            <span ng-repeat="player in displayableField.field[3]" >
                                <div class="tooltip">
                                    <span ng-class="{'teamx': player.team == 'x', 'teamo': player.team == 'o',
                                                    'playeroff':  player.off == true}">
                                        {{player.number}} <span ng-show="displayableField.ballholder.id == player.id">.</span>
                                    </span>
                                    <span class="tooltiptext">{{player}}</span>
                                </div> 
                            </span> 
                        </td>            
                    </tr>
                    <tr>			<td>
                            <span ng-repeat="player in displayableField.field[4]" >
                                <div class="tooltip">
                                    <span ng-class="{'teamx': player.team == 'x', 'teamo': player.team == 'o',
                                                    'playeroff':  player.off == true}">
                                        {{player.number}} <span ng-show="displayableField.ballholder.id == player.id">.</span>
                                    </span>
                                    <span class="tooltiptext">{{player}}</span>
                                </div> 
                            </span> 
                        </td>			<td>
                            <span ng-repeat="player in displayableField.field[5]" >
                                <div class="tooltip">
                                    <span ng-class="{'teamx': player.team == 'x', 'teamo': player.team == 'o',
                                                    'playeroff':  player.off == true}">
                                        {{player.number}} <span ng-show="displayableField.ballholder.id == player.id">.</span>
                                    </span>
                                    <span class="tooltiptext">{{player}}</span>
                                </div> 
                            </span> 
                        </td>
                    </tr>
                    <tr>
                        <td colspan=2 style="text-align:center">
                            <div class="tooltip">
                                <span class="teamo">
                                    {{displayableField.keeper['o'].number}}
                                    <span ng-show="displayableField.ballholder.id == displayableField.keeper['o'].id">.</span>
                                    <span class="tooltiptext">{{displayableField.keeper['o']}}</span>
                                </span>
                            </div>
                        </td>
                     </tr>
                </tbody>
            </table>
        </td>
            <td>
<span >
                    <button class="buttono button" ng-click="pass('o',-1,-1)">&nwarr; ({{displayableField.chanceso[0]}})</button>    
                    <button class="buttono button" ng-click="pass('o',0,-1)">&uarr;({{displayableField.chanceso[1]}}%)</button>  
                    <button class="buttono button" ng-click="pass('o',1,-1)">&nearr;({{displayableField.chanceso[2]}}%)</button>  
                    <br>
                    <button class="buttono button" ng-click="pass('o',-1,0)">&larr;({{displayableField.chanceso[3]}}%)</button>
                    <button class="buttono button" ng-click="dibre('o')">Z ({{displayableField.chanceso[4]}}%)</button>
                    <button class="buttono button" ng-click="pass('o',1,0)">&rarr; ({{displayableField.chanceso[5]}}%)</button>    
                    <br>
                    <button class="buttono button" ng-click="pass('o',-1,1)">&swarr; ({{displayableField.chanceso[6]}}%)</button>    
                    <button class="buttono button" ng-click="pass('o',0,1)">&darr; ({{displayableField.chanceso[7]}}%)</button>    
                    <button class="buttono button" ng-click="pass('o',1,1)">&searr; ({{displayableField.chanceso[8]}}%)</button>   
                    <br>
                    <button class="buttono button" ng-click="shot('o')">Shot O ({{displayableField.chanceso[9]}}%)</button>      
                </span>
            </td>
        </tr>
    </tbody>
    </table>
running : {{displayableField}}
<hr>
found: {{chances}}

</div>

<script>
var app = angular.module('myApp', []);
var game = {};
var TEAMX = "x";
var TEAMO = "o";

    
    
function rand(n){
    return Math.floor(Math.random() * n);
}   
    
    
    

function createTestGame(){
    

    
    var field = [];
    
    for (let i = 2; i <= 11; ++i){
        var player2 = { 
                            number: i,
                            defense:rand(10), 
                            pass:rand(10), 
                            attack:rand(10), 
                            team: TEAMX, 
                            sector:rand(6),
                            id: rand(100)*rand(100)
                        };
        field.push(player2);
    }
    for (let i = 2; i <= 11; ++i){
        var player2 = { 
                            number: i,
                            defense:rand(10), 
                            pass:rand(10), 
                            attack:rand(10), 
                            team: TEAMO, 
                            sector:rand(6),
                            id: rand(100)*rand(100)                            
                        };
        field.push(player2);
    }
    
    
    game.playersdown = [];
    game.ballholder = field[rand(20)];
    game.field = field;
    game.scorex = 0;
    game.scoreo = 0;
    game.keeper = [];
    game.keeper[TEAMX] = { 
                            number: 1,
                            pass: 10,
                            defense:rand(10), 
                            team: TEAMX, 
                            sector:-1,
                            id: rand(100)*rand(100)                            
                        };
    game.keeper[TEAMO] = { 
                            number: 1,
                            pass: 10,
                            defense:rand(10), 
                            team: TEAMO, 
                            sector:-2,
                            id: rand(100)*rand(100)                            
                        };
    
    return game;
}

function displayField(game){
    
    var field = [[],[],[],[],[],[]];
    game.field.forEach(function(player){
        var dispPlayer = Object.assign({}, player);;
        game.playersdown.forEach(function(playerdown){
            if(playerdown.id == player.id){
                dispPlayer.off = true;
            }
        })
        field[player.sector].push(dispPlayer); 
    });
    var displayable = {};
    displayable.field = field;
    displayable.ballholder = game.ballholder;
    displayable.keeper = [];
    displayable.keeper['x'] = game.keeper[TEAMX]
    displayable.keeper['o'] = game.keeper[TEAMO]
    
    displayable.scoreo = game.scoreo;
    displayable.scorex = game.scorex;
    
    var getchances = function(team){
        return [(passProcess(team,-1,-1).chance * 100).toFixed(2),
                      (passProcess(team,0,-1).chance * 100).toFixed(2),
                      (passProcess(team,1,-1).chance * 100).toFixed(2),
                      (passProcess(team,-1,0).chance * 100).toFixed(2),
                      
                      (dibreProcess(team).chance * 100).toFixed(2),
                      
                      (passProcess(team,1,0).chance * 100).toFixed(2),
                      (passProcess(team,-1,1).chance * 100).toFixed(2),
                      (passProcess(team,0,1).chance * 100).toFixed(2),
                      (passProcess(team,1,1).chance * 100).toFixed(2),
                      
                      (shotProcess(team,-1,0).chance * 100).toFixed(2)
                      ]
    }
    
    displayable.chanceso = getchances(TEAMO);
    displayable.chancesx = getchances(TEAMX);    
    
  
    
    
		
    return displayable;
}    
    
function processTick(game, commandP1, commandP2, scope){
    /*console.log("Processing:")
    console.log(game);
    console.log(commandP1);
    console.log(commandP2);
    */
    return displayField(game);
    
}
    
    
    app.controller('myCtrl', function($scope/*, $interval*/) {
   
    game = createTestGame();
    
        
    $scope.pass = function(team, axisx, axisy){
        var actionResult = passProcess(team, axisx, axisy);
        if(actionResult.newBallholder){
            game.ballholder = actionResult.newBallholder;
            actionResult.messages.forEach(function(msg){console.log("ACTION MSG: " + msg)})
            $scope.displayableField = processTick(game, commandP1, commandP2);
        }
        resetOffPlayers();
    }
    
    $scope.shot = function(team) {
        var actionResult = shotProcess(team);
        game.scoreo = actionResult.scoreo;
        game.scorex = actionResult.scorex;
        game.ballholder = actionResult.newBallholder;
            
        actionResult.messages.forEach(function(msg){console.log("ACTION MSG: " + msg)})
        $scope.displayableField = processTick(game, commandP1, commandP2);
        resetOffPlayers();
    }
    
    $scope.dibre = function(team) {
        var actionResult = dibreProcess(team);
        game.ballholder = actionResult.newBallholder;
        if(actionResult.playerdown){
            game.playersdown.push(actionResult.playerdown);
        }
        
        actionResult.messages.forEach(function(msg){console.log("ACTION MSG: " + msg)})
        $scope.displayableField = processTick(game, commandP1, commandP2);
    }
    
    var commandP1 = "pass to joao";
    var commandP2 = "mark joao";
    
    
  //  $interval(function(){$scope.displayableField = processTick(game, commandP1, commandP2), 10000, 1})
    $scope.displayableField = processTick(game, commandP1, commandP2);
    //setInterval(function(){$scope.displayableField = "samba"}, 900);
    
//    /processTick(createTestGame(), commandP1, commandP2)
    
});
    
    
</script>

</body>
</html>